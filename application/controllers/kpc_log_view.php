<?php  class Kpc_log_view extends CI_Controller  {    function __construct()	 {	    parent::__construct();		 $this->load->helper('url');		 $this->load->library('session');		 $this->load->model('q2a/Question_process');		 $this->load->model('q2a/Kpc_manage');		 $this->load->model('q2a/Auth');		 $this->load->model('q2a/Right_nav_data');         $this->load->model('q2a/Load_common_label');         $this->load->model('q2a/Ip_location');	 }     function index()	 {	 }     function load_label($lang)     {         $kpc_label = $this->load_kpc_label($lang);         $common_label = $this->Load_common_label->load_common_label($lang);         $result = array_merge($kpc_label,$common_label);         return $result;     }     //load kpc label here     function load_kpc_label($lang)     {        $this->lang->load('kpc_log',$lang);        $data['kpc_log_page_title'] = $this->lang->line('kpc_log_page_title');        $data['kpc_log_title'] = $this->lang->line('kpc_log_title');        $data['kpc_log_event'] = $this->lang->line('kpc_log_event');        $data['kpc_log_score_change'] = $this->lang->line('kpc_log_score_change');        $data['kpc_log_score_left'] = $this->lang->line('kpc_log_score_left');        $data['kpc_log_time'] = $this->lang->line('kpc_log_time');        $kpc_type = $this->load_kpc_type($lang);        $data = array_merge($data,$kpc_type);        return $data;     }     function load_kpc_type($lang)     {        $this->lang->load('kpc_log',$lang);        $prefix = "kpc_log_type_";        for($i=1;$i<=13;$i++)        {            $key = $prefix.$i;            $data[$key] = $this->lang->line($key);        }        return $data;     }	 //request kpc log data for page split	 function data_request()	 {	   if($this->Auth->request_access_check())	   {           $language = $this->Ip_location->get_language();	       $base = $this->config->item('base_url');	       $segs = $this->uri->segment_array();		   //login permission check		   $this->Auth->permission_check($base."login/");		   //get current login user id		   $user_id = $this->session->userdata('uId');		   $data = array('base'=>$base);		   $data['login'] = "login";		   //data for page split		   $data['total_num'] = $this->Kpc_manage->get_log_num($user_id);		   $data['pre_num'] = $this->config->item('pre_kpc_num');		   $data['page_num'] = ($data['total_num'] == 0) ? 1 : ceil($data['total_num']/$data['pre_num']);		   $data['current_index'] = $segs[2];		   $range = array('start'=>($segs[2]-1)*$data['pre_num']+1,'end'=>$segs[2]*$data['pre_num']);		   $data['kpc_log_data'] = $this->Kpc_manage->get_log_by_num(array('uId'=>$user_id),$range);		   //label data for right navigation		   $right_data = $this->Right_nav_data->get_rgiht_nav_data($user_id);		   $label = $this->load_label($language);		   $data = array_merge($right_data,$data,$label);		   $this->load->view('q2a/kpc_log_view',$data);	   }	 }	 	function kpc_pagination_request()	{		if($this->Auth->request_access_check())		{			$base = $this->config->item('base_url');			//login permission check			$this->Auth->permission_check($base."login/");			//get current login user id			$user_id = $this->session->userdata('uId');						$index = $this->input->post('index');			$pre_num = $this->config->item('pre_kpc_num');			$range = array('start'=>($index-1)*$pre_num+1,'end'=>$index*$pre_num);			$kpc_log_data = $this->Kpc_manage->get_log_by_num(array('uId'=>$user_id),$range);			$html = '';			if(!empty($kpc_log_data))			{				$prefix = "kpc_log_type_";				$language = $this->Ip_location->get_language();				$data = $this->load_kpc_type($language);				foreach($kpc_log_data as $kpc_log_item)				{					$key = $prefix.$kpc_log_item['event'];					$html .= '<tr>';					$html .= '<td>'.$data[$key].'</td>';					$html .= ($kpc_log_item['score_changed'] > 0) ? '<td>+' : '<td>';					$html .= $kpc_log_item['score_changed'].'</td>';					$html .= '<td>'.$kpc_log_item['score_left'].'</td>';					$html .= '<td>'.$kpc_log_item['time'].'</td>';					$html .= '</tr>';				}			}			echo $html;		}	}  }/*End of file*//*Location: ./system/appllication/controller/kpc_log_view.php*/